# mesh

Mesh data types

[![python](https://img.shields.io/badge/python-3.11-blue.svg)](https://www.python.org/)
![os](https://img.shields.io/badge/os-ubuntu%20|%20macos%20|%20windows-blue.svg)
[![license](https://img.shields.io/badge/license-MIT-green.svg)](https://github.com/sandialabs/sibl#license) 
[![Code style: black](https://img.shields.io/badge/code%20style-black-000000.svg)](https://github.com/psf/black)

[![tests](https://github.com/autotwin/mesh/workflows/tests/badge.svg)](https://github.com/autotwin/mesh/actions) [![codecov](https://codecov.io/gh/autotwin/mesh/branch/main/graph/badge.svg?token=XY0UAVX3OD)](https://codecov.io/gh/autotwin/mesh)


## Config

See [config/README.md](config/README.md)

## Workflow

See [doc/README.md](doc/README.md)

## Schema

| `key` | type | description |
| --- | --- | --- |
| `autotwin_header` | dict | Header used for pedigree and tracking purposes
| - `created`       | string | A manual (or script autogenerated) date and time step, e.g., `created: "2023-04-26-1533-MST"`
| - `source`        | string | The person, machine, or script that generated the `.yml` input
`bounding_box` | dict | 
| - `auto`     | bool | `True` - Sculpt autogenerates the bounding box, and `xmin` through `zmax` parameters are ignored </br>`False` - User `xmin` through `zmax` paramters are used for the bounding box.
| - `defeatured` | bool | `True` turns on defeaturing near the bounding box boundary.</br>`False` turns off defeaturing near the bounding box boundary.
| - `xmin` | float | The `x-coordinate` minimum of the bounding box.
| - `ymin` | float | The `y-coordinate` minimum of the bounding box.
| - `zmin` | float | The `z-coordinate` minimum of the bounding box.
| - `xmax` | float | The `x-coordinate` maximum of the bounding box.
| - `ymax` | float | The `y-coordinate` maximum of the bounding box.
| - `zmax` | float | The `z-coordinate` maximum of the bounding box.
| `cell_size` | float | The Sculpt cell size, in units of the `.stl` input file for the Sculpt baseline mesh size.
| ~~`csv_path_file`~~ | string | **deprecated** in version 1.6, superceded by `qualities`
| `cubit_path` | string | The full path to the Cubit executable, e.g., `"/Applications/Cubit-16.08/Cubit.app/Contents/MacOS"`
| `inp_path_file` | string | The full path to the ABAQUS `.inp` mesh file, e.g., "~/autotwin/mesh/tests/files/sphere.inp"
| `journaling` | bool | `True` - turn on Cubit journaling of the process, `False` is off.
| `n_procs` | int | The number of parallel processors uses for Sculpt
| `qualities` | tuple(str,) | Mesh quality metrics of the `.inp` mesh specified by the `inp_path_file` key, zero or more of the following: `("aspect ratio", "scaled jacobian", "skew")`
| `stl_path_files` | list(str) | A list of one or more strings.  Each string contains the path and file to an input `.stl` file given to Sculpt
| `version` | float | The version of the `.yml` input file
| `working_dir` | string | The path for the Cubit/Sculpt working directory, e.g., temporary files, journal files

## Updates

### 2023-04-26

`.yml` input version from `1.5` to `1.6`, updated keys:

 `qualities: (string,)` is a tuple of strings with zero or more of the following: `("aspect ratio", "scaled jacobian", "skew")`
  * Example: All of the quality metrics:
    * `qualities: ("aspect ratio", "scaled jacobian", "skew")`
  * Example: One quality metric, skew:
    * `qualities: ("skew")`
  * Example: Zero quality metrics:
    * `qualities: ()`

**deprecated:** `csv_path_file` now ~~`csv_path_file`~~ (no longer used)
 * Previously use for `.csv` output of a hard-coded quality metric, e.g., *minimum scaled Jacobian*
   * Example:  
     * `csv_path_file: "~/Downloads/scratch/Utah_SCI_brain/cell_100_msj.csv"`
 * Now naming for quality metric `.csv` outputs is autogenerated, based on the tuple of quality metric string(s) used as input to the [`cubit_inp_to_quality_csv.py`](src/atmesh/cubit_inp_to_quality_csv.py) module.
   * Example:
     * `.inp` file: `"~/autotwin/mesh/tests/files/sphere_cell_0010.inp"` and `("scaled jacobian")` as inputs produce
     * `.csv` file: `"/Users/chovey/autotwin/mesh/tests/files/sphere_cell_0010_scaled_jacobian.csv"`

### 2023-04-12

`.yml` input version from `1.4` to `1.5`, updated keys:

* `bounding_box: (auto, defeatured, xmin, xmax, ymin, ymax, zmin, zmax)`
   * `auto (boolean)`
      * `True` (default) Sculpt chooses the bounding box.
      * `False` The user input `xmin, xmax, ymin, ymax, zmin, zmax` defined the bounding box.
   * `defeatured (boolean)`
      * maps to Sculpt `defeature_bbox` and `defeature 1` (on)
      * `True` turns on Sculpt defeature, and defeatures at boundary of the bounding box.
      * `False` (default) turns off Sculpt defeature, and no defature at the boundary of the bounding box occurs.

where the bounding box is defined with two points, a minimum and a maximum, as follows:

$$(x, y, z)_{\min} = \mathtt{ (xmin, ymin, zmin)}$$

and

$$(x, y, z)_{\max} = \mathtt{ (xmax, ymax, zmax)}$$


### 2023-03-03

* Python from 3.7.9 to 3.11.2.
* Virtual environment naming from `atmeshenv` to `.venv`.
* `sculpt_stl_to_inp.py` input `.yml` file version from `1.3` to `1.4`.

### Equations Example

From https://github.blog/2022-05-19-math-support-in-markdown/

When $a \ne 0$, there are two solutions to $(ax^2 + bx + c = 0)$ and they are

$$ x = {-b \pm \sqrt{b^2-4ac} \over 2a} $$

**The Cauchy-Schwarz Inequality**

```math
\left( \sum_{k=1}^n a_k b_k \right)^2 \leq \left( \sum_{k=1}^n a_k^2 \right) \left( \sum_{k=1}^n b_k^2 \right)
```

## Future Reading

* https://github.com/pyenv/pyenv
